<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: sound.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: sound.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Represents the audio processing setup
 * 
 * @todo clean up &amp;&amp; organize
 */
class Sound {

    /**
     * Setup audio processing
     * @todo ScriptProcessorNode is deprecated, replace it and ensure other functions are okay
     */
    constructor () {

        /**
         * Current sound amplitude.
         * @type  {Number}
         * @public
         * @readonly
         */
        this.amplitudeUniform = {type: 'f', value: 0};  // Shader uniform object usable by Three.js, to achieve pass-by-reference

        // Setup analysis
        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        this.analyser = this.startAnalysis(this.audioContext, 256);
        // this.sourceBuffer = this.audioContext.createBufferSource();

        // Wire up source -> analyser -> destination
        this.sourceElement = document.querySelector('audio#playlist');
        this.sourceBuffer = this.audioContext.createMediaElementSource(this.sourceElement);
        this.sourceBuffer.connect(this.analyser);
        this.analyser.connect(this.audioContext.destination);

        // @todo make from mic too
        this.sourceElement.play();
    }

    /**
     * Analyzes audio stream on the given AudioContext
     * @todo writeme
     * @param  {Number}  fftSize  Fast Fourier Transform size = analysis resolution; must be power of 2 and twice the number of samples
     *
     * @returns  {AnalyserNode}  AnalyserNode object analysis is done on
     */
    startAnalysis (audioContext, fftSize) {

        // Setup analyser node
        var analyser = audioContext.createAnalyser();
        analyser.fftSize = fftSize;

        // Start analysis loop and return
        var closureThis = this;
        var audioFrameBuffer = new Uint8Array(analyser.frequencyBinCount);
        var analysisLoop = function() {
            requestAnimationFrame(analysisLoop);
            analyser.getByteFrequencyData(audioFrameBuffer);
            closureThis.amplitudeUniform.value = (audioFrameBuffer[3] + audioFrameBuffer[30] + audioFrameBuffer[100]) / (3 * 19);
        };
        analysisLoop();
        return analyser;
    }

    /**
     * Decodes audio buffer
     * @todo writeme &amp;&amp; write meaningful error handling
     * 
     * @param  buffer
     */
    decode (buffer) {

        var closureThis = this;
        this.audioContext.decodeAudioData(buffer,
            function (decodedBuffer) {
                closureThis.sourceBuffer.buffer = decodedBuffer;
                closureThis.sourceBuffer.start(0);
            },
            function () {
                throw new Error('Audio decoding failed');
            }
        );
    }
}

export default Sound;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Shaders.html">Shaders</a></li><li><a href="Shims.html">Shims</a></li><li><a href="Sonografi.html">Sonografi</a></li><li><a href="Sound.html">Sound</a></li><li><a href="Util.html">Util</a></li><li><a href="Viewport.html">Viewport</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sat Jul 09 2016 22:19:13 GMT+0300 (RTZ 2 (зима))
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
